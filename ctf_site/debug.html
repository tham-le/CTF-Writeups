<!DOCTYPE html>
<html>
<head>
    <title>CTF Events Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .event-card { border: 1px solid #ccc; margin: 10px; padding: 15px; }
        .event-header { display: flex; justify-content: space-between; }
        .category-tag { background: #f0f0f0; padding: 2px 8px; margin: 2px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>CTF Events Debug</h1>
    <div id="debug-output"></div>
    <div id="events-container"></div>
    
    <script>
        let allData = null;
        
        async function loadAndDisplay() {
            try {
                console.log('Loading data...');
                const response = await fetch('assets/writeups/index.json');
                allData = await response.json();
                
                console.log('Data loaded:', allData);
                
                document.getElementById('debug-output').innerHTML = `
                    <p><strong>Data loaded successfully!</strong></p>
                    <p>Events: ${allData.events.length}</p>
                    <p>Writeups: ${allData.writeups.length}</p>
                `;
                
                displayEvents();
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('debug-output').innerHTML = `
                    <p style="color: red;"><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }
        
        function displayEvents() {
            const container = document.getElementById('events-container');
            
            if (!allData || !allData.events) {
                container.innerHTML = '<p>No events data found</p>';
                return;
            }
            
            container.innerHTML = allData.events.map(event => `
                <div class="event-card">
                    <div class="event-header">
                        <h3>${event.name}</h3>
                        <span>${event.writeups.length} writeups</span>
                    </div>
                    <p>Categories: ${[...new Set(event.writeups.map(w => w.category))].map(cat => 
                        `<span class="category-tag">${cat}</span>`
                    ).join('')}</p>
                    <p>Preview: ${getPreview(event.description)}</p>
                </div>
            `).join('');
            
            console.log(`Displayed ${allData.events.length} events`);
        }
        
        function getPreview(description) {
            if (!description) return 'No description available';
            const lines = description.split('\n');
            for (let line of lines) {
                line = line.trim();
                if (line && !line.startsWith('#') && line.length > 10) {
                    return line.length > 100 ? line.substring(0, 100) + '...' : line;
                }
            }
            return 'CTF Event';
        }
        
        loadAndDisplay();
    </script>
</body>
</html>
